<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Make Appointment — Hospitals</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<link rel="stylesheet" href="/static/styles/hospitalPage.css">
</head>
<body>
	<form id="pagination-counter" style="display: none;">
		<input id="currPage" name='currPage'value=1></input>
		<input id="pageSize" name='pageSize' value=10></input>
		<input id="pageCount" name='pageCount' value=0></input>
		<input id="searchKey" name='searchKey' value=''></input>
	</form>
	<nav class="navbar navbar-light" style="background-color: #2D79D6;">
	  <!-- Navbar content -->
	  <span class="navbar-brand mb-0 h1" style="color:white;">WeCare</span>

	  <div id="user-link-wrapper">
		  <a href="/patientSettings" class="navbar-link navbar-right" style="color:white;">User</a>
			<a class="navbar-link navbar-right" style="color:white;" href="/logout">Logout</a>

	  </div>
	</nav>
	<div id="content-wrapper">
		<div id="header-wrapper">
			<div class='header'id="header-1">
				<div id="header-1-left">
					<div id="back-btn-wrapper">
						<div id="back-btn-arrow" onclick="goToHomePage()"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-left-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
						  <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5.5a.5.5 0 0 0 0-1H5.707l2.147-2.146a.5.5 0 1 0-.708-.708l-3 3a.5.5 0 0 0 0 .708l3 3a.5.5 0 0 0 .708-.708L5.707 8.5H11.5z"/>
						</svg>
						</div>
						<div id="header-1-title">Make an appointment</div>
					</div>
					<span></span>
				</div>
				<div id="header-1-right">
					<span></span>
					<div id="appoint-btn-container">
						<button type="button" class="btn btn-primary btn-sm" id="view-record-btn" onclick="goToPage('patientRecord', 0)">My appointments</button>
					</div>
				</div>
			</div>
			<div class='header' id='header-2'>
				<div class="header-2-component "id="header-2-upper">
					<div class="input-group input-group-sm mb-3">

					  <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="search-input" placeholder="搜索医院 医生" >
  					  <div class="input-group-append">
					<button type="button" class="btn btn-light" id='doSearch' onclick="searchHospital(this)"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
					  <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
					  <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
					</svg></button>
					  </div>
					</div>
				</div>
<!-- 				<div class="header-2-component" id="header-2-lower">

					<div class="btn-group">
						<div class="dropdown-wrapper">
						  <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="dropdown1">
						    区域
						  </button>
						  <div class="dropdown-menu">
						    ...
						  </div>
						</div>
						<div class="dropdown-wrapper">
						  <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="dropdown2">
						    排序
						  </button>
						  <div class="dropdown-menu">
						    ...
						  </div>
						</div>

						<div class="dropdown-wrapper">
						  <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="dropdown3">
						    等级
						  </button>
						  <div class="dropdown-menu">
						    ...
						  </div>
						</div>
					</div>
				</div>
 -->
			</div>
		</div>
		<div id="hospital-list-container">
			<div id="card-container">

			</div>
			<div id="list-footer">
				<div id="pagecount">Total：</div>
				<div id="pagination-container"><nav aria-label="...">
				  <ul class="pagination">
				    <li class="page-item disabled">
				      <span class="page-link">Previous</span>
				    </li>
				    <li class="page-item active"><a class="page-link" href="#">1</a></li>
				    <li class="page-item ">
				      <a class="page-link" href='#'>2</a>
				    </li>
				    <li class="page-item"><a class="page-link" href="#">3</a></li>
				    <li class="page-item">
				      <a class="page-link" href="#">Next</a>
				    </li>
				  </ul>
					</nav>
				</div>
			</div>

		</div>
	</div>




	<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
	<script type="text/javascript" src="/static/js/function/util.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			requestHospitalData();

			$('.page-item').click(function(){
				var pageInfo= $('#pagination-counter').serializeArray();
				console.log(pageInfo);
				var currPage = $('.active');
				if($(this).hasClass('active')){
					console.log('skipped');
				}
				else{
					goSelectedPageNum(currPage,this);
					console.log(getPageInfo());
				}

			})




		})

		//搜索医院
		//需要带上分页 重置当前页
		function searchHospital(){
			var hospital = $('#search-input').val();
			$('#searchKey').val(hospital);
			if(hospital != ''){
				console.log(hospital);
				data = $('#pagination-counter').serializeArray();
				data = jsonify(data);
				$.ajax({
					url:"http://localhost:5000/searchHospital",
					data:data,
					success:function(data){
						console.log(data);
						//分页样式设置
						//设定第一页为active
						$('#currPage').val(1);
						renderHospital(data);
					}
				})
			}



		}

		function setPageNum(){
			// $('.')
		}

		//切换选中的页面按钮
		function goSelectedPageNum(i,j){
			// console.log($(i).text());
			$(i).removeClass("active");
			$(j).addClass("active");

			$('#currPage').val($('.active').children('a').text());

			//ajax请求
			var formData = jsonify($('#pagination-counter').serializeArray());
			$.ajax({
				data:formData,
				type:'POST',
				url:"http://localhost:5000/hospitalData",
				success:function(data){
					console.log(data);
					// var temp=[{'hospitalName':'东方医院','hospitalAddr':'someAddress'}];
					renderHospital(data);
				}
			})

		}

		function requestHospitalData(){
			//ajax请求
			var formData = jsonify($('#pagination-counter').serializeArray());
			$.ajax({
				data:formData,
				type:'POST',
				url:"http://localhost:5000/hospitalData",
				success:function(data){
					console.log(data);
					// var temp=[{'hospitalName':'东方医院','hospitalAddr':'someAddress'}];
					renderHospital(data);
				}
			})
		}

		function jsonify(data){
			var obj = {};
			for(var i=0;i<data.length;i++){
				if(data[i].name!='pageCount'){
					obj[data[i].name]=data[i].value;
				}
			}
			return obj;
		}

		function getPageInfo(){
			return $('#pagination-counter').serializeArray();
		}

		function renderHospital(data){
			var length = data.length;
			$('#card-container').empty();
			var i;
			for(i=0;i<length;i++){
				var card = '<div class="hospital-card"><div class="hospital-card-left"><div class="picture-holder"></div><div class="hospital-info"><div class="hospital-name">'+data[i]['name']+'</div><div class="hospital-addr">'+data[i]['address']+'</div></div></div><div class="hospital-card-right"><button type="button" class="btn btn-primary selectHospital" id='+data[i]['id']+' onclick=goToHospital(this)>Make an appointment</button></div></div>';
				$('#card-container').append(card);
			}
			if(data.length != 0){
				$('#pagecount').empty();
				$('#pagecount').append('Total '+data[0]['n_tot_records']);
			}

		}

		function goToHospital(th){
				console.log($(th).attr('id'));
				var hospitalID = $(th).attr('id');

				window.location.replace("http://localhost:5000/goToHospital/"+hospitalID);


		}

		function goToHomePage(){
			window.location.replace('http://localhost:5000/loadHomePage');
		}

	</script>
</body>
</html>
